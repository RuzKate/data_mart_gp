# Построение витрины данных для отчета «Информация по клиенту»
Витрина данных (Data Mart) — это совокупность взаимосвязанных объектов БД, хранящих согласованную
информацию об одной логической сущности (бизнес-объекта, отчета и т.п). Витрины данных предоставляют агрегированные и структурированные данные для удобного анализа и построения отчетов.
## Описание
Данный проект представляет собой реализацию витрины данных, предназначенной для агрегации и хранения информации о клиентах. Источники данных представлены в формате CSV-файлов, хранящихся на удаленном сервере. Проект включает в себя следующие этапы:
1. Создание внешних таблиц

    На первом этапе проекта осуществляется создание внешних таблиц в системе управления базами данных Greenplum. Каждая внешняя таблица сопоставлена с отдельным CSV-файлом, расположенным на удаленном сервере. Внешние таблицы обеспечивают доступ к данным, хранящимся в этих файлах, как к обычным таблицам. Далее проводится анализ этих таблиц-источников.

    Описание таблиц-источников:

    | Объект | Delimiter | Описание |
    |--------|-----------|----------|
    | cl_corp | ^ | Таблица корпоративных клиентов |
    | client | ^ | Таблица клиентов |
    | personal_address | ^ | Таблица адресов |
    | address_type | ^ | Таблица типов адресов |
    | names_city | ^ | Справочник по городам |
    | contacts | ^ | Таблица контактных данных |
    | comunication | ^ | Справочник по контактным данным |
    | persons_pos | ^ | Справочник должностей |
    | casta | ^ | Таблица должностей сотрудников |
    | tax_insp | ^ | Таблица регистрации ФНС |
    | tax_inspect | ^ | Справочник регистрации ФНС |
    | region | ^ | Справочник регионов |
    | ins_restrict | , | Справочник по типу банкротства |
    | st_client | , | Таблица банкротов |
    | okved_ref | , | Справочник ОКВЭД |
    | okved | , | Таблица ОКВЭД |
    | cl_bank | , | Справочник по клиентам |
    | cl_group | , | Таблица клиентов по ВХО |
    | cl_categories | ^ | Таблица категории | клиента |
    | cl_org | ^ | Таблица клиентов-организаций |
    | country | , | Справочник по странам |
    | cl_bank_n | ^ | Таблица клиентов банка |
    | form_property | ^ | Таблица кратких наименований |
    | ownership_type | ^ | Справочник типов комуниуации |
2. Создание таблицы витрины cust_org

   Создается таблица cust_org, служащая хранилищем для агрегированной информации о клиентах. В таблицу включаются наиболее релевантные поля, описывающие характеристики клиента. Для заполнения таблицы cust_org данными из внешних таблиц создается функция insert_data_cust_org, выполняющая следующие действия:
    - Извлечение информации: выполняет серию SQL-запросов к внешним таблицам для получения необходимых данных. 
    - Преобразование данных: проводит оптимизацию кода и преобразования данных к нужному формату.
    - Вставка данных: вставляет обработанные данные в таблицу cust_org.
4. Партиционирование таблицы cust_org

    Для повышения производительности запросов к таблице cust_org применяется партиционирование. Данные в таблице делятся на отдельные части (партиции) по заданным критериям. В данном проекте реализовано два уровня партицирования:
    - Партиции первого уровня: делят данные по последнему символу из поля inn.
    - Партиции второго уровня: делят данные по столбцу okopf_code.

    Секционирование реализовано с помощью механизма наследования таблиц, что дает возможность разделить таблицы по вычисляемому, а не по всему полю. Для автоматического распределения данных по соответствующим партициям при вставке в таблицу cust_org_partitioned создаются специальные правила. 

## Структура проекта
```sql_scripts/``` - папка с sql-скриптами:
- ```create_external_tables.sql``` - скрипт, содержащий инструкции для создания внешних таблиц
- ```create_data_mart.sql``` - скрипт со структурой витрины данных
- ```partition_table.sql``` - скрипт, содержащий реализацию партиционирование таблицы
- ```insert_data_cust_org.sql``` - скрипт с функцией, добавляющей данные в витрину данных

```csv_files/``` - папка с csv-файлами
